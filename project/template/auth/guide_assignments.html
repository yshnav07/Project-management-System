{% extends 'base.html' %}

{% block title %}Manage Assignments{% endblock %}

{% block sidebar %}
<a href="{% url 'guide-dashboard' %}" class="nav-link text-white d-flex align-items-center">
  <span class="me-2">ğŸ“Š</span> Dashboard
</a>
<a href="{% url 'guide-students' %}" class="nav-link text-white d-flex align-items-center">
  <span class="me-2">ğŸ‘¨â€ğŸ“</span> Manage Students
</a>
<a href="{% url 'guide-assignments' %}" class="nav-link text-white d-flex align-items-center active">
  <span class="me-2">ğŸ“</span> Assignments
</a>
<a href="{% url 'guide-projects' %}" class="nav-link text-white d-flex align-items-center">
  <span class="me-2">ğŸ’¡</span> Projects
</a>
<a href="{% url 'guide-queries' %}" class="nav-link text-white d-flex align-items-center">
  <span class="me-2">â“</span> Queries
</a>

<a href="{% url 'guide-profile' %}" class="nav-link text-white d-flex align-items-center">
  <span class="me-2">âš™ï¸</span> Settings
</a>
{% endblock %}

{% block content %}

<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="fw-bold ">ğŸ“‘ Manage Assignments</h2>
  <button class="btn btn-success btn-sm shadow" data-bs-toggle="collapse" data-bs-target="#createForm">
    â• New Assignment
  </button>
</div>

<!-- Assignment Form -->
<div id="createForm" class="collapse mb-4">
  <div class="card shadow border-0 rounded-4">
    <div class="card-header bg-primary text-white rounded-top-4">
      <h5 class="mb-0">ğŸ“Œ Create New Assignment</h5>
    </div>
    <div class="card-body">
      <form method="post" novalidate>
        {% csrf_token %}
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label fw-semibold">Title</label>
            <input type="text" name="title" class="form-control" placeholder="Enter assignment title" required>
          </div>
          <div class="col-md-6">
            <label class="form-label fw-semibold">Due Date</label>
            <input type="date" name="due_date" class="form-control">
          </div>
        </div>

        <div class="mb-3 mt-3">
          <label class="form-label fw-semibold">Description</label>
          <textarea name="description" class="form-control" rows="3" placeholder="Write a brief description..."
            required></textarea>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold">Assign To</label>
          <select name="target_group" class="form-select" required>
            <option value="my_students">My Assigned Students</option>
            <option value="all">All Students</option>
          </select>
        </div>

        <div class="text-end">
          <button type="submit" class="btn btn-success px-4 shadow">âœ” Create Assignment</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Assignment List -->
<div class="card shadow border-0 rounded-4">
  <div class="card-header bg-light rounded-top-4">
    <h5 class="mb-0 fw-semibold">ğŸ“‚ Existing Assignments</h5>
  </div>
  <div class="card-body">
    {% if rows %}
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-primary">
          <tr>
            <th>Title</th>
            <th>Target Group</th>
            <th>Due Date</th>
            <th>Progress</th>
            <th class="text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for row in rows %}
          <tr>
            <td class="fw-semibold">{{ row.assignment.title }}</td>
            <td>
              {% if row.assignment.target_group == "all" %}
              ğŸŒ All Students
              {% else %}
              ğŸ‘¨â€ğŸ“ My Students
              {% endif %}
            </td>
            <td>{{ row.assignment.due_date|default:"â€”" }}</td>
            <td>
              <div class="progress" style="height: 20px;">
                <div class="progress-bar 
                    {% if row.percentage < 40 %} bg-danger
                    {% elif row.percentage < 70 %} bg-warning
                    {% else %} bg-success {% endif %}" 
                    role="progressbar" 
                    style="width: {{ row.percentage }}%;" 
                    aria-valuenow="{{ row.submitted }}" 
                    aria-valuemin="0" 
                    aria-valuemax="{{ row.total }}">
                  {{ row.submitted }} / {{ row.total }}
                </div>
              </div>
            </td>
            <td class="text-center">
              <a href="{% url 'guide-submissions' row.assignment.id %}" 
                 class="btn btn-sm btn-outline-primary me-1 shadow-sm">ğŸ“¥ Submissions</a>
              <a href="{% url 'update-assignment' row.assignment.id %}" 
                 class="btn btn-sm btn-outline-warning me-1 shadow-sm">âœ Edit</a>
              <a href="{% url 'delete-assignment' row.assignment.id %}" 
                 class="btn btn-sm btn-outline-danger shadow-sm"
                 onclick="return confirm('âš  Are you sure you want to delete this assignment?');">ğŸ—‘ Delete</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <p class="text-muted mb-0">No assignments created yet.</p>
    {% endif %}
  </div>
</div>

{% endblock %}
